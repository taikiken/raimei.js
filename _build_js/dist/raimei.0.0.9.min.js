/*
 inazumatv.com
 @author (at)taikiken / http://inazumatv.com
 @date 2014/04/19 - 16:37

 Copyright (c) 2011-2014 inazumatv.com, inc.

 Distributed under the terms of the MIT license.
 http://www.opensource.org/licenses/mit-license.html

 This notice shall be included in all copies or substantial portions of the Software.
*/
var RAIMEI={};
(function(d){var a=d.self;a.console=a.console||{info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}};Date.now||(Date.now=function(){return(new Date).getTime()});(function(){for(var b=0,e=["ms","moz","webkit","o"],c=0;c<e.length&&!a.requestAnimationFrame;++c)a.requestAnimationFrame=a[e[c]+"RequestAnimationFrame"],a.cancelAnimationFrame=a[e[c]+"CancelAnimationFrame"]||a[e[c]+"CancelRequestAnimationFrame"];void 0===a.requestAnimationFrame&&void 0!==a.setTimeout&&
(a.requestAnimationFrame=function(c){var e=Date.now(),d=Math.max(0,16-(e-b)),k=a.setTimeout(function(){c(e+d)},d);b=e+d;return k});void 0===a.cancelAnimationFrame&&void 0!==a.clearTimeout&&(a.cancelAnimationFrame=function(c){a.clearTimeout(c)})})();Object.create||(Object.create=function(){function b(){}return function(e){if(1!==arguments.length)throw Error("Object.create implementation only accepts one parameter.");b.prototype=e;return new b}}());Array.isArray||(Array.isArray=function(b){return"[object Array]"===
Object.prototype.toString.call(b)});Array.prototype.indexOf||(Array.prototype.indexOf=function(b,e){var c;c=e?e:0;var f;if(!this)throw new TypeError;f=this.length;if(0===f||c>=f)return-1;for(0>c&&(c=f-Math.abs(c));c<f;c++)if(this[c]===b)return c;return-1});Array.prototype.forEach||(Array.prototype.forEach=function(b,e){var c,f;c=0;for(f=this.length;c<f;++c)c in this&&b.call(e,this[c],c,this)});Function.prototype.bind||(Function.prototype.bind=function(b){if("function"!==typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");
var e=Array.prototype.slice.call(arguments,1),c=this,f=function(){},a=function(){return c.apply(this instanceof f&&b?this:b,e.concat(Array.prototype.slice.call(arguments)))};f.prototype=this.prototype;a.prototype=new f;return a});String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")};d.AudioContext=d.AudioContext||d.webkitAudioContext||d.mozAudioContext||d.oAudioContext||d.msAudioContext})(window);
(function(d){d=d.RAIMEI;d.extend=function(a,b){b.prototype=Object.create(a.prototype);b.prototype.constructor=b};d.isNumeric=function(a){return!isNaN(parseFloat(a))&&isFinite(a)};d.maxValue=function(a){return Math.max.apply(null,a)};d.startTime=function(){return 0}})(window);(function(d){d.RAIMEI.Detector=function(){function a(){throw Error("can't create instance");}a.detects=function(){return!!d.AudioContext};return a}()})(window);
(function(d){d.EventDispatcher=function(){function a(){this._listeners={}}var b=a.prototype;b.constructor=d.EventDispatcher;b.addEventListener=function(e,c){"undefined"===typeof this._listeners&&(this._listeners={});var f=this._listeners;"undefined"===typeof f[e]&&(f[e]=[]);-1===f[e].indexOf(c)&&f[e].push(c)};b.hasEventListener=function(e,c){var f=this._listeners;return"undefined"!==typeof f&&"undefined"!==typeof c[e]&&-1!==f[e].indexOf(c)?!0:!1};b.removeEventListener=function(e,c){if("undefined"!==
typeof this._listeners){var f=this._listeners[e],a;"undefined"!==typeof f&&(a=f.indexOf(c),-1!==a&&f.splice(a,1))}};b.dispatchEvent=function(e){var c=this._listeners,a,b;if("undefined"!==typeof c&&"undefined"!==typeof e.type&&(c=c[e.type],"undefined"!==typeof c))for(e.target=this,a=0,b=c.length;a<b;a++)c[a].call(this,e)};a.initialize=function(a){a.addEventListener=b.addEventListener;a.hasEventListener=b.hasEventListener;a.removeEventListener=b.removeEventListener;a.dispatchEvent=b.dispatchEvent};
return a}()})(window.RAIMEI);(function(d){d.RAIMEI.Context=function(){function a(){var a=new d.AudioContext;a.createGain||(a.createGain=a.createGainNode);a.createDelay||(a.createDelay=a.createDelayNode);a.createScriptProcessor||(a.createScriptProcessor=a.createJavaScriptNode);this._context=a}a.prototype.get=function(){return this._context};return a}()})(window);
(function(d){d=d.RAIMEI;var a=d.EventDispatcher;d.BufferLoader=function(){function b(a,e){this._context=a;this._url=e}var e=b.prototype;a.initialize(e);e.load=function(){function a(){h.removeEventListener("load",e);h.removeEventListener("error",b)}function e(){a();d.decodeAudioData(h.response,function(a){a?m.dispatchEvent({type:"load",buffer:a,context:d,currentTarget:h}):m.dispatchEvent({type:"error",error:Error("error decoding file data: "+k),currentTarget:h})},function(a){m.dispatchEvent({type:"error",
error:Error("decode error: "+k+", error: "+a),currentTarget:h})})}function b(){a();m.dispatchEvent({type:"error",error:Error("file not found: "+k),currentTarget:h})}var d=this._context,k=this._url,m=this,h;h=new XMLHttpRequest;h.addEventListener("load",e,!1);h.addEventListener("error",b,!1);h.open("GET",k,!0);h.responseType="arraybuffer";h.send(null)};return b}()})(window);
(function(d){d.RAIMEI.BufferSource=function(){function a(a,e){var c=a.createBufferSource();c.buffer=e;c.start=c.start||c.noteOn;c.stop=c.stop||c.noteOff;this._source=c}a.prototype.getSource=function(){return this._source};return a}()})(window);
(function(d){d.RAIMEI.VolumeControl=function(){function a(a,c){var b=a.createGain();c.connect(b);b.connect(a.destination);this._gainNode=b;this._gain=b.gain}var b=a.prototype;b.setVolume=function(a){this._gain.value=this._normalize(a)};b.getVolume=function(){return this._gain.value};b.getGainNode=function(){return this._gainNode};b.getGain=function(){return this._gain};b._normalize=function(a){a=parseFloat(a);0>a?a=0:1<a&&(a=1);return a};return a}()})(window);
(function(d){var a=d.RAIMEI,b=a.EventDispatcher,e=a.isNumeric;a.PlaySoundWithBuffer=function(){function c(a,c,b){this._context=a;this._buffer=c;this._loop=!!b;this._offset=0;this._boundEnded=this._onEnded.bind(this);this._duration=c.duration;this._pause=!1}var f=c.prototype;b.initialize(f);f.start=function(){this._offset=0;this.play(0,0)};f.play=function(a,c){e(c)||(c=0);this._pause=!1;var b=this._createSource(this._context,this._buffer);b.loop=this._loop;b.addEventListener("ended",this._boundEnded,
!1);b.onended=function(){};b.start(this._context.currentTime+a,c);this.dispatchEvent({type:"play",duration:this._duration,delay:a,offset:c,currentTarget:this._source});this._source=b};f.stop=function(){this._stop();this.dispatchEvent({type:"stop",currentTarget:this._source})};f.pause=function(){var a=this._context.currentTime%this._duration;this._dispose();this._stop();this._pause=!0;this._offset=a;this.dispatchEvent({type:"pause",offset:a,currentTarget:this._source})};f.resume=function(){this._pause=
!1;this.play(0,this._offset);this.dispatchEvent({type:"resume",offset:this._offset,currentTarget:this._source})};f.setVolume=function(a){this._volumeControl.setVolume(a)};f.getVolume=function(){return this._volumeControl.getVolume()};f.getDuration=function(){return this._duration};f.getOffset=function(){return this._offset};f.getBuffer=function(){return this._buffer};f.getBufferSource=function(){return this._bufferSource};f.getVolumeControl=function(){return this._volumeControl};f.getContext=function(){return this._context};
f.getSource=function(){return this._source};f._dispose=function(){this._source.removeEventListener("ended",this._boundEnded)};f._stop=function(){var a=this._source;a&&a.stop();this._pause&&(this._pause=!1,this.dispatchEvent({type:"ended",currentTarget:a}))};f._onEnded=function(){var a=this._source;this._offset=0;this.dispatchEvent({type:"ended",currentTarget:a});this._dispose()};f._createSource=function(c,b){var e,f,d;e=new a.BufferSource(c,b);f=e.getSource();d=new a.VolumeControl(c,f);this._bufferSource=
e;this._volumeControl=d;return f};return c}()})(window);(function(d){d.RAIMEI.Octave=function(){function a(){throw Error("can't create instance");}a.OCTAVE=1200;return a}()})(window);(function(d){d.RAIMEI.Cents=function(){function a(a){this._cents_value=a}var b=a.prototype;b.getCents=function(){return this._cents_value};b.setCents=function(a){this._cents_value=a};return a}()})(window);
(function(d){var a=d.RAIMEI,b=a.Cents,e=a.Octave;a.Semitone=function(){function c(a){b.call(this,100*a);this._semitone_value=a}a.extend(b,c);var f=c.prototype;f.getSemitone=function(){return this._semitone_value};f.setSemitone=function(a){this._semitone_value=a;this.setCents(100*a)};f.shiftOctave=function(a){a=parseInt(a,10)||1;2<a?a=2:-2>a&&(a=-2);this.setSemitone(this._semitone_value+a*e.OCTAVE)};return c}()})(window);
(function(d){d.RAIMEI.VolumeControlWithOscillator=function(){function a(a,c){var b=a.createGain();c.connect(b);b.connect(a.destination);this._gainNode=b;this._gain=b.gain}var b=a.prototype;b.setVolume=function(a){this._gain.value=this._normalize(a)};b.getVolume=function(){return this._gain.value};b.getGainNode=function(){return this._gainNode};b.getGain=function(){return this._gain};b._normalize=function(a){a=parseFloat(a);0>a?a=0:1<a&&(a=1);return a};return a}()})(window);
(function(d){var a=d.RAIMEI;a.Oscillator=function(){function b(c,b,e,d){c=c.createOscillator();this._semitone=b=new a.Semitone(b);c.frequency.value=d;c.detune.value=b.getCents();c.type=e;c.start=c.start||c.noteOn;c.stop=c.stop||c.noteOff;this._oscillator_node=c}b.SINE=0;b.SQUARE=1;b.SAWTOOTH=2;b.TRIANGLE=3;b.CUSTOM=4;var e=b.prototype;e.getOscillator=function(){return this._oscillator_node};e.setFrequency=function(a){this._oscillator_node.frequency.value=a};e.setSemitone=function(a){var b=this._semitone;
b.setSemitone(a);this._oscillator_node.detune.value=b.getCents()};e.setType=function(a){this._oscillator_node.type=a};return b}()})(window);
(function(d){var a=d.RAIMEI,b=a.EventDispatcher,e=a.isNumeric,c=a.Oscillator;a.PlaySoundWithOscillator=function(){function d(a,b,f,h){this._context=a;this._semitone_value=parseInt(b,10);this._type=e(f)?f:c.SINE;this._khz=e(h)?Math.abs(h):440}var g=d.prototype;b.initialize(g);g.start=function(){this.play(0);this.dispatchEvent({type:"start",delay:0,khz:this._khz,semitone:this._semitone_value,wave:this._type,currentTarget:this})};g.play=function(b){var c=this._context,d=this._semitone_value,e=this._type,
f=this._khz,g,l;g=new a.Oscillator(c,d,e,f);l=g.getOscillator();(new a.VolumeControlWithOscillator(c,l)).setVolume(1);this._oscillator_node=l;this._oscillator=g;l.start(b);this.dispatchEvent({type:"play",delay:b,khz:f,semitone:d,wave:e,currentTarget:l})};g.stop=function(){this._oscillator_node.stop(0);this.dispatchEvent({type:"stop",delay:0,khz:this._khz,semitone:this._semitone_value,wave:this._type,currentTarget:this})};g.getOscillator=function(){return this._oscillator_node};g.getType=function(){return this._type};
g.setType=function(a){this._type=a};g.getKHZ=function(){return this._khz};g.setKHZ=function(a){this._oscillator&&this._oscillator.setFrequency(a);this._khz=a};g.getSemitone=function(){return this._semitone_value};g.setSemitone=function(a){this._oscillator&&this._oscillator.setSemitone(a);this._semitone_value=a};return d}()})(window);(function(d){var a=d.RAIMEI,b=a.PlaySoundWithOscillator;a.PlaySoundBySine=function(){function d(c,e,g){b.call(this,c,e,a.Oscillator.SINE,g)}a.extend(b,d);return d}()})(window);
