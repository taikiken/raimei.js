/*
 inazumatv.com
 @author (at)taikiken / http://inazumatv.com
 @date 2014/04/19 - 16:37

 Copyright (c) 2011-2014 inazumatv.com, inc.

 Distributed under the terms of the MIT license.
 http://www.opensource.org/licenses/mit-license.html

 This notice shall be included in all copies or substantial portions of the Software.

 @module RAIMEI
*/
var RAIMEI={version:"0.0.9"};
(function(d){var a=d.self;a.console=a.console||{info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}};Date.now||(Date.now=function(){return(new Date).getTime()});(function(){for(var c=0,e=["ms","moz","webkit","o"],f=0;f<e.length&&!a.requestAnimationFrame;++f)a.requestAnimationFrame=a[e[f]+"RequestAnimationFrame"],a.cancelAnimationFrame=a[e[f]+"CancelAnimationFrame"]||a[e[f]+"CancelRequestAnimationFrame"];void 0===a.requestAnimationFrame&&void 0!==a.setTimeout&&
(a.requestAnimationFrame=function(b){var e=Date.now(),f=Math.max(0,16-(e-c)),d=a.setTimeout(function(){b(e+f)},f);c=e+f;return d});void 0===a.cancelAnimationFrame&&void 0!==a.clearTimeout&&(a.cancelAnimationFrame=function(b){a.clearTimeout(b)})})();Object.create||(Object.create=function(){function c(){}return function(e){if(1!==arguments.length)throw Error("Object.create implementation only accepts one parameter.");c.prototype=e;return new c}}());Array.isArray||(Array.isArray=function(c){return"[object Array]"===
Object.prototype.toString.call(c)});Array.prototype.indexOf||(Array.prototype.indexOf=function(c,e){var f;f=e?e:0;var b;if(!this)throw new TypeError;b=this.length;if(0===b||f>=b)return-1;for(0>f&&(f=b-Math.abs(f));f<b;f++)if(this[f]===c)return f;return-1});Array.prototype.forEach||(Array.prototype.forEach=function(c,e){var f,b;f=0;for(b=this.length;f<b;++f)f in this&&c.call(e,this[f],f,this)});Function.prototype.bind||(Function.prototype.bind=function(c){if("function"!==typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");
var e=Array.prototype.slice.call(arguments,1),f=this,b=function(){},a=function(){return f.apply(this instanceof b&&c?this:c,e.concat(Array.prototype.slice.call(arguments)))};b.prototype=this.prototype;a.prototype=new b;return a});String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")};d.AudioContext=d.AudioContext||d.webkitAudioContext||d.mozAudioContext||d.oAudioContext||d.msAudioContext})(window);
(function(d){d=d.RAIMEI;d.extend=function(a,c){c.prototype=Object.create(a.prototype);c.prototype.constructor=c};d.isNumeric=function(a){return!isNaN(parseFloat(a))&&isFinite(a)};d.maxValue=function(a){return Math.max.apply(null,a)};d.startTime=function(){return 0}})(window);(function(d){d.RAIMEI.Detector=function(){function a(){throw Error("can't create instance");}a.detects=function(){return!!d.AudioContext};return a}()})(window);
(function(d){d.EventDispatcher=function(){function a(){this._listeners={}}var c=a.prototype;c.constructor=d.EventDispatcher;c.addEventListener=function(e,f){"undefined"===typeof this._listeners&&(this._listeners={});var b=this._listeners;"undefined"===typeof b[e]&&(b[e]=[]);-1===b[e].indexOf(f)&&b[e].push(f)};c.hasEventListener=function(e,f){var b=this._listeners;return"undefined"!==typeof b&&"undefined"!==typeof f[e]&&-1!==b[e].indexOf(f)?!0:!1};c.removeEventListener=function(e,f){if("undefined"!==
typeof this._listeners){var b=this._listeners[e],a;"undefined"!==typeof b&&(a=b.indexOf(f),-1!==a&&b.splice(a,1))}};c.dispatchEvent=function(e){var a=this._listeners,b,c;if("undefined"!==typeof a&&"undefined"!==typeof e.type&&(a=a[e.type],"undefined"!==typeof a))for(e.target=this,b=0,c=a.length;b<c;b++)a[b].call(this,e)};a.initialize=function(a){a.addEventListener=c.addEventListener;a.hasEventListener=c.hasEventListener;a.removeEventListener=c.removeEventListener;a.dispatchEvent=c.dispatchEvent};
return a}()})(window.RAIMEI);(function(d){d.RAIMEI.Context=function(){function a(){var a=new d.AudioContext;a.createGain||(a.createGain=a.createGainNode);a.createDelay||(a.createDelay=a.createDelayNode);a.createScriptProcessor||(a.createScriptProcessor=a.createJavaScriptNode);this._context=a}a.prototype.get=function(){return this._context};return a}()})(window);
(function(d){d=d.RAIMEI;var a=d.EventDispatcher;d.BufferLoader=function(){function c(a,b){this._context=a;this._url=b}var e=c.prototype;a.initialize(e);e.load=function(){function a(){g.removeEventListener("load",b);g.removeEventListener("error",e)}function b(){a();c.decodeAudioData(g.response,function(a){a?k.dispatchEvent({type:"load",buffer:a,context:c,currentTarget:g}):k.dispatchEvent({type:"error",error:Error("error decoding file data: "+d),currentTarget:g})},function(a){k.dispatchEvent({type:"error",
error:Error("decode error: "+d+", error: "+a),currentTarget:g})})}function e(){a();k.dispatchEvent({type:"error",error:Error("file not found: "+d),currentTarget:g})}var c=this._context,d=this._url,k=this,g;g=new XMLHttpRequest;g.addEventListener("load",b,!1);g.addEventListener("error",e,!1);g.open("GET",d,!0);g.responseType="arraybuffer";g.send(null)};return c}()})(window);
(function(d){d.RAIMEI.BufferSource=function(){function a(a,c){var b=a.createBufferSource();b.buffer=c;b.start=b.start||b.noteOn;b.stop=b.stop||b.noteOff;this._source=b}var c=a.prototype;c.constructor=a;c.getSource=function(){return this._source};return a}()})(window);
(function(d){d.RAIMEI.VolumeControl=function(){function a(a,c){var b=a.createGain();c.connect(b);b.connect(a.destination);this._gainNode=b;this._gain=b.gain}var c=a.prototype;c.constructor=a;c.setVolume=function(a){this._gain.value=this._normalize(a)};c.getVolume=function(){return this._gain.value};c.getGainNode=function(){return this._gainNode};c.getGain=function(){return this._gain};c._normalize=function(a){a=parseFloat(a);0>a?a=0:1<a&&(a=1);return a};return a}()})(window);
(function(d){var a=d.RAIMEI,c=a.EventDispatcher,e=a.isNumeric;a.PlaySoundWithBuffer=function(){function f(a,b,c){this._context=a;this._buffer=b;this._loop=!!c;this._offset=0;this._boundEnded=this._onEnded.bind(this);this._duration=b.duration;this._pause=!1}var b=f.prototype;b.constructor=f;c.initialize(b);b.start=function(){this._offset=0;this.play(0,0)};b.play=function(a,b){e(b)||(b=0);this._pause=!1;var c=this._createSource(this._context,this._buffer);c.loop=this._loop;c.addEventListener("ended",
this._boundEnded,!1);c.onended=function(){};c.start(this._context.currentTime+a,b);this.dispatchEvent({type:"play",duration:this._duration,delay:a,offset:b,currentTarget:this._source});this._source=c};b.stop=function(){this._stop();this.dispatchEvent({type:"stop",currentTarget:this._source})};b.pause=function(){var a=this._context.currentTime%this._duration;this._dispose();this._stop();this._pause=!0;this._offset=a;this.dispatchEvent({type:"pause",offset:a,currentTarget:this._source})};b.resume=function(){this._pause=
!1;this.play(0,this._offset);this.dispatchEvent({type:"resume",offset:this._offset,currentTarget:this._source})};b.setVolume=function(a){this._volumeControl.setVolume(a)};b.getVolume=function(){return this._volumeControl.getVolume()};b.getDuration=function(){return this._duration};b.getOffset=function(){return this._offset};b.getBuffer=function(){return this._buffer};b.getBufferSource=function(){return this._bufferSource};b.getVolumeControl=function(){return this._volumeControl};b.getContext=function(){return this._context};
b.getSource=function(){return this._source};b._dispose=function(){this._source.removeEventListener("ended",this._boundEnded)};b._stop=function(){var a=this._source;a&&a.stop();this._pause&&(this._pause=!1,this.dispatchEvent({type:"ended",currentTarget:a}))};b._onEnded=function(){var a=this._source;this._offset=0;this.dispatchEvent({type:"ended",currentTarget:a});this._dispose()};b._createSource=function(b,c){var e,f,d;e=new a.BufferSource(b,c);f=e.getSource();d=new a.VolumeControl(b,f);this._bufferSource=
e;this._volumeControl=d;return f};return f}()})(window);(function(d){d.RAIMEI.Octave=function(){function a(){throw Error("can't create instance");}a.OCTAVE=1200;return a}()})(window);(function(d){d.RAIMEI.Cents=function(){function a(a){this._cents_value=a}var c=a.prototype;c.getCents=function(){return this._cents_value};c.setCents=function(a){this._cents_value=a};return a}()})(window);
(function(d){var a=d.RAIMEI,c=a.Cents,e=a.Octave;a.Semitone=function(){function f(a){c.call(this,100*a);this._semitone_value=a}a.extend(c,f);var b=f.prototype;b.getSemitone=function(){return this._semitone_value};b.setSemitone=function(a){this._semitone_value=a;this.setCents(100*a)};b.setSemitone=function(a){this._semitone_value=a;this.setCents(100*a)};b.shiftOctave=function(a){a=parseInt(a,10)||1;2<a?a=2:-2>a&&(a=-2);this.setSemitone(this._semitone_value+a*e.OCTAVE)};return f}()})(window);
(function(d){d.RAIMEI.VolumeControlWithOscillator=function(){function a(a,c){var b=a.createGain();c.connect(b);b.connect(a.destination);this._gainNode=b;this._gain=b.gain}var c=a.prototype;c.constructor=a;c.setVolume=function(a){this._gain.value=this._normalize(a)};c.getVolume=function(){return this._gain.value};c.getGainNode=function(){return this._gainNode};c.getGain=function(){return this._gain};c._normalize=function(a){a=parseFloat(a);0>a?a=0:1<a&&(a=1);return a};return a}()})(window);
(function(d){var a=d.RAIMEI;a.Oscillator=function(){function c(c,b,e,d){c=c.createOscillator();this._semitone=new a.Semitone(b);c.frequency.value=d;c.type=e;c.start=c.start||c.noteOn;c.stop=c.stop||c.noteOff;this._oscillator_node=c;this.setSemitone(b)}c.SINE=0;c.SQUARE=1;c.SAWTOOTH=2;c.TRIANGLE=3;c.CUSTOM=4;var e=c.prototype;e.constructor=c;e.getOscillator=function(){return this._oscillator_node};e.setFrequency=function(a){this._oscillator_node.frequency.value=a};e.setSemitone=function(a){var b=this._semitone;
b.setSemitone(a);this._oscillator_node.detune.value=b.getCents()};e.setType=function(a){this._oscillator_node.type=a};return c}()})(window);
(function(d){var a=d.RAIMEI,c=a.EventDispatcher,e=a.isNumeric,f=a.Oscillator;a.PlaySoundWithOscillator=function(){function b(a,b,c,d){this._context=a;this._semitone_value=parseInt(b,10);this._type=e(c)?c:f.SINE;this._khz=e(d)?Math.abs(d):440}var d=b.prototype;d.constructor=b;c.initialize(d);d.start=function(){this.play(0);this.dispatchEvent({type:"start",delay:0,khz:this._khz,semitone:this._semitone_value,wave:this._type,currentTarget:this})};d.play=function(b){var c=this._context,d=this._semitone_value,
e=this._type,f=this._khz,l,h;l=new a.Oscillator(c,d,e,f);h=l.getOscillator();(new a.VolumeControlWithOscillator(c,h)).setVolume(1);this._oscillator_node=h;this._oscillator=l;h.start(b);this.dispatchEvent({type:"play",delay:b,khz:f,semitone:d,wave:e,currentTarget:h})};d.stop=function(){this._oscillator_node.stop(0);this.dispatchEvent({type:"stop",delay:0,khz:this._khz,semitone:this._semitone_value,wave:this._type,currentTarget:this})};d.getOscillator=function(){return this._oscillator_node};d.getType=
function(){return this._type};d.setType=function(a){this._type=a};d.getKHZ=function(){return this._khz};d.setKHZ=function(a){this._oscillator&&this._oscillator.setFrequency(a);this._khz=a};d.getSemitone=function(){return this._semitone_value};d.setSemitone=function(a){this._oscillator&&this._oscillator.setSemitone(a);this._semitone_value=a};return b}()})(window);
(function(d){var a=d.RAIMEI,c=a.PlaySoundWithOscillator;a.PlaySoundBySine=function(){function d(e,b,m){c.call(this,e,b,a.Oscillator.SINE,m)}a.extend(c,d);return d.prototype.constructor=d}()})(window);
