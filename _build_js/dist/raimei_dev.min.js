/*
 inazumatv.com
 @author (at)taikiken / http://inazumatv.com
 @date 2014/04/19 - 16:37

 Copyright (c) 2011-2014 inazumatv.com, inc.

 Distributed under the terms of the MIT license.
 http://www.opensource.org/licenses/mit-license.html

 This notice shall be included in all copies or substantial portions of the Software.
*/
var RAIMEI={};
(function(f){var d=f.self;d.console=d.console||{info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}};Date.now||(Date.now=function(){return(new Date).getTime()});(function(){for(var a=0,e=["ms","moz","webkit","o"],b=0;b<e.length&&!d.requestAnimationFrame;++b)d.requestAnimationFrame=d[e[b]+"RequestAnimationFrame"],d.cancelAnimationFrame=d[e[b]+"CancelAnimationFrame"]||d[e[b]+"CancelRequestAnimationFrame"];void 0===d.requestAnimationFrame&&void 0!==d.setTimeout&&
(d.requestAnimationFrame=function(c){var b=Date.now(),e=Math.max(0,16-(b-a)),f=d.setTimeout(function(){c(b+e)},e);a=b+e;return f});void 0===d.cancelAnimationFrame&&void 0!==d.clearTimeout&&(d.cancelAnimationFrame=function(b){d.clearTimeout(b)})})();Object.create||(Object.create=function(){function a(){}return function(e){if(1!==arguments.length)throw Error("Object.create implementation only accepts one parameter.");a.prototype=e;return new a}}());Array.isArray||(Array.isArray=function(a){return"[object Array]"===
Object.prototype.toString.call(a)});Array.prototype.indexOf||(Array.prototype.indexOf=function(a,e){var b;b=e?e:0;var c;if(!this)throw new TypeError;c=this.length;if(0===c||b>=c)return-1;for(0>b&&(b=c-Math.abs(b));b<c;b++)if(this[b]===a)return b;return-1});Array.prototype.forEach||(Array.prototype.forEach=function(a,e){var b,c;b=0;for(c=this.length;b<c;++b)b in this&&a.call(e,this[b],b,this)});Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!==typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");
var e=Array.prototype.slice.call(arguments,1),b=this,c=function(){},d=function(){return b.apply(this instanceof c&&a?this:a,e.concat(Array.prototype.slice.call(arguments)))};c.prototype=this.prototype;d.prototype=new c;return d});String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")};f.AudioContext=f.AudioContext||f.webkitAudioContext||f.mozAudioContext||f.oAudioContext||f.msAudioContext})(window);
(function(f){f=f.RAIMEI;f.extend=function(d,a){a.prototype=Object.create(d.prototype);a.prototype.constructor=a};f.isNumeric=function(d){return!isNaN(parseFloat(d))&&isFinite(d)};f.maxValue=function(d){return Math.max.apply(null,d)};f.startTime=function(){return 0}})(window);(function(f){f.RAIMEI.Detector=function(){function d(){throw Error("can't create instance");}d.detects=function(){return!!f.AudioContext};return d}()})(window);
(function(f){f.EventDispatcher=function(){function d(){this._listeners={}}var a=d.prototype;a.constructor=f.EventDispatcher;a.addEventListener=function(e,b){"undefined"===typeof this._listeners&&(this._listeners={});var c=this._listeners;"undefined"===typeof c[e]&&(c[e]=[]);-1===c[e].indexOf(b)&&c[e].push(b)};a.hasEventListener=function(e,b){var c=this._listeners;return"undefined"!==typeof c&&"undefined"!==typeof b[e]&&-1!==c[e].indexOf(b)?!0:!1};a.removeEventListener=function(e,b){if("undefined"!==
typeof this._listeners){var c=this._listeners[e],a;"undefined"!==typeof c&&(a=c.indexOf(b),-1!==a&&c.splice(a,1))}};a.dispatchEvent=function(e){var b=this._listeners,c,a;if("undefined"!==typeof b&&"undefined"!==typeof e.type&&(b=b[e.type],"undefined"!==typeof b))for(e.target=this,c=0,a=b.length;c<a;c++)b[c].call(this,e)};d.initialize=function(e){e.addEventListener=a.addEventListener;e.hasEventListener=a.hasEventListener;e.removeEventListener=a.removeEventListener;e.dispatchEvent=a.dispatchEvent};
return d}()})(window.RAIMEI);(function(f){f.RAIMEI.Context=function(){function d(){var a=new f.AudioContext;a.createGain||(a.createGain=a.createGainNode);a.createDelay||(a.createDelay=a.createDelayNode);a.createScriptProcessor||(a.createScriptProcessor=a.createJavaScriptNode);this._context=a}d.prototype.get=function(){return this._context};return d}()})(window);
(function(f){f=f.RAIMEI;var d=f.EventDispatcher;f.BufferLoader=function(){function a(b,c){this._context=b;this._url=c}var e=a.prototype;d.initialize(e);e.load=function(){function b(){g.removeEventListener("load",c);g.removeEventListener("error",a)}function c(){b();e.decodeAudioData(g.response,function(b){b?f.dispatchEvent({type:"load",buffer:b,context:e,currentTarget:g}):f.dispatchEvent({type:"error",error:Error("error decoding file data: "+d),currentTarget:g})},function(b){f.dispatchEvent({type:"error",
error:Error("decode error: "+d+", error: "+b),currentTarget:g})})}function a(){b();f.dispatchEvent({type:"error",error:Error("file not found: "+d),currentTarget:g})}var e=this._context,d=this._url,f=this,g;g=new XMLHttpRequest;g.addEventListener("load",c,!1);g.addEventListener("error",a,!1);g.open("GET",d,!0);g.responseType="arraybuffer";g.send(null)};return a}()})(window);
(function(f){f.RAIMEI.BufferSource=function(){function d(a,e){var b=a.createBufferSource();b.buffer=e;b.start=b.start||b.noteOn;b.stop=b.stop||b.noteOff;this._source=b}d.prototype.getSource=function(){return this._source};return d}()})(window);
(function(f){f.RAIMEI.VolumeControl=function(){function d(a,b){var c=a.createGain();b.connect(c);c.connect(a.destination);this._gainNode=c;this._gain=c.gain}var a=d.prototype;a.volume=function(a){console.log("VolumeControl ",a);this._gain.value=this._normalize(a);console.log("VolumeControl _gain",this._gain)};a.getGainNode=function(){return this._gainNode};a.getGain=function(){return this._gain};a._normalize=function(a){0>a?a=0:1<a&&(a=1);return a};return d}()})(window);
(function(f){var d=f.RAIMEI,a=d.EventDispatcher,e=d.isNumeric;d.PlaySoundWithBuffer=function(){function b(a,b,c){this._context=a;this._buffer=b;this._loop=!!c;this._offset=0;this._boundEnded=this._onEnded.bind(this);this._duration=b.duration;this._pause=!1}var c=b.prototype;a.initialize(c);c.start=function(){this._offset=0;this.play(0,0)};c.play=function(a,b){e(b)||(b=0);this._pause=!1;var c=this._createSource(this._context,this._buffer);c.loop=this._loop;c.addEventListener("ended",this._boundEnded,
!1);c.onended=function(){};c.start(this._context.currentTime+a,b);this.dispatchEvent({type:"start",duration:this._duration,delay:a,offset:b,currentTarget:this._source});this._source=c};c.stop=function(){this._stop();this.dispatchEvent({type:"stop",currentTarget:this._source})};c.pause=function(){var a=this._context.currentTime%this._duration;this._dispose();this._stop();this._pause=!0;this._offset=a;this.dispatchEvent({type:"pause",offset:a,currentTarget:this._source})};c.resume=function(){this._pause=
!1;this.play(0,this._offset);this.dispatchEvent({type:"resume",offset:this._offset,currentTarget:this._source})};c.volume=function(a){this._volumeControl.volume(a)};c.getDuration=function(){return this._duration};c.getOffset=function(){return this._offset};c.getBuffer=function(){return this._buffer};c.getBufferSource=function(){return this._bufferSource};c.getVolumeControl=function(){return this._volumeControl};c.getContext=function(){return this._context};c.getSource=function(){return this._source};
c._dispose=function(){this._source.removeEventListener("ended",this._boundEnded)};c._stop=function(){var a=this._source;a&&a.stop();this._pause&&(this._pause=!1,this.dispatchEvent({type:"ended",currentTarget:a}))};c._onEnded=function(){var a=this._source;this._offset=0;this.dispatchEvent({type:"ended",currentTarget:a});this._dispose()};c._createSource=function(a,b){var c,e,f;c=new d.BufferSource(a,b);e=c.getSource();f=new d.VolumeControl(a,e);this._bufferSource=c;this._volumeControl=f;return e};return b}()})(window);
